plugins {
    id 'java'
    id 'war'
}

group 'com.example'
version '1.0'

repositories {
    mavenCentral()
}

// Task to install dependencies
task installNode(type: Exec) {
    description = "Install Node.js if available"
    commandLine 'sh', '-c', 'command -v node >/dev/null 2>&1 || { echo >&2 "Node.js is required"; exit 1; }'
}

task installDeps(type: Exec, dependsOn: installNode) {
    description = "Install npm dependencies"
    commandLine 'npm', 'install'
    workingDir = file('.')
}

task buildApp(type: Exec, dependsOn: installDeps) {
    description = "Build production app using Vite"
    commandLine 'npm', 'run', 'build'
}

task copyDistToWebapp(type: Copy, dependsOn: buildApp) {
    from 'dist'
    into "$buildDir/resources/main/webapp"
}

war {
    archiveFileName = "expense.war"
    destinationDirectory = file("$buildDir/deploy")
    from "$buildDir/resources/main/webapp"
}

defaultTasks 'help'

task help {
    doLast {
        println """
        ðŸ’¡ Available Gradle Tasks:
        --------------------------
        ./gradlew buildApp       -> Builds the React app
        ./gradlew war            -> Packages as WAR file
        ./gradlew help           -> Show this message
        """
    }
}
