// build.gradle
plugins {
    id 'application'
}

repositories {
    mavenCentral()
}

task installNode(type: Exec) {
    description = "Install Node.js dependencies"
    commandLine 'sh', '-c', 'command -v node >/dev/null 2>&1 || { echo >&2 "Node.js is required"; exit 1; }'
    onlyIf { !file('frontend/node_modules').exists() }
}

task installDeps(type: Exec, dependsOn: installNode) {
    description = "Install frontend dependencies"
    commandLine 'npm', 'install'
    workingDir = file('frontend')
}

task startDevServer(type: Exec, dependsOn: installDeps) {
    description = "Start development server"
    commandLine 'npm', 'run', 'dev'
    workingDir = file('frontend')
}

task buildApp(type: Exec, dependsOn: installDeps) {
    description = "Build production version"
    commandLine 'npm', 'run', 'build'
    workingDir = file('frontend')
}

task previewApp(type: Exec, dependsOn: buildApp) {
    description = "Preview built app"
    commandLine 'npm', 'run', 'preview'
    workingDir = file('frontend')
}

defaultTasks 'help'

task help {
    doLast {
        println """
        ðŸ’¡ Available Gradle Tasks:
        --------------------------
        ./gradlew buildApp       -> Builds the production app
        ./gradlew startDevServer -> Starts dev server
        ./gradlew previewApp     -> Preview built app
        """
    }
}
